---
- name: Run path.sh across all hosts
  hosts: all
  become: true

  vars:
    HOST: "{{ couch_host }}"
    PORT: "{{ couch_port }}"
    USER: "{{ couch_user }}"
    PASS: "{{ couch_pass }}"

  tasks:
    # ------------------------------------------------------------------
    # Copy path.sh into the ubuntu user's home directory
    # ------------------------------------------------------------------
    - name: Copy path.sh to $HOME
      copy:
        src: "{{ playbook_dir }}/path.sh"
        dest: "/home/ubuntu/path.sh"  # still explicit path for reliability
        mode: "0755"
        owner: ubuntu
        group: ubuntu

    # ------------------------------------------------------------------
    # Execute path.sh once, capturing its output to path.txt
    # Using $HOME so we don't hardâ€‘code /home/ubuntu in the command
    # ------------------------------------------------------------------
    - name: Run path.sh script once
      become_user: ubuntu
      shell: |
        "$HOME"/path.sh > "$HOME"/path.txt
      args:
        chdir: "$HOME"
